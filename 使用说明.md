# 麻将助手Android应用使用说明

## 项目简介

麻将助手是一款全麻将通用视觉辅助应用，使用Kivy框架和OpenCV技术，为用户提供实时的麻将牌分析和出牌建议。

## 功能特性

### 🎯 核心功能
- **全麻将规则支持**：覆盖广东鸡平胡、四川血战到底、长沙麻将等多种玩法
- **实时听牌分析**：自动计算当前手牌的听牌情况
- **最优出牌推荐**：基于对手出牌分析，推荐最安全的出牌
- **风险牌提示**：识别可能点炮的风险牌
- **对手听牌概率**：实时计算三家对手的听牌概率
- **悬浮窗显示**：不影响游戏操作的悬浮窗界面

### 📱 界面特点
- **简洁直观**：清晰的信息展示
- **实时响应**：0.5秒快速刷新
- **色彩区分**：不同信息使用不同颜色标识
- **规则切换**：支持快速切换麻将规则

## 安装说明

### 方法1：直接安装APK
1. 下载生成的APK文件（`mahjongassist-1.0.0-debug.apk`）
2. 在Android设备上打开APK文件
3. 按照提示完成安装
4. 首次启动时会请求必要权限

### 方法2：通过GitHub Actions构建
1. 将代码推送到GitHub仓库
2. 进入仓库的Actions页面
3. 运行"Build Android App"工作流
4. 构建完成后在Artifacts中下载APK

## 使用指南

### 首次使用
1. **授予权限**：启动应用后，按照提示授予以下权限：
   - 悬浮窗权限（SYSTEM_ALERT_WINDOW）
   - 录音权限（RECORD_AUDIO，用于屏幕捕获）
   - 存储权限（读取/写入外部存储）
   - 媒体控制权限（MEDIA_CONTENT_CONTROL）

2. **开启悬浮窗**：
   - 在系统设置中找到"麻将助手"
   - 开启"显示在其他应用上层"权限
   - 开启"后台弹出界面"权限

3. **选择规则**：
   - 在悬浮窗顶部的下拉菜单中选择当前的麻将规则
   - 系统会自动根据选择的规则调整分析逻辑

### 日常使用
1. **启动应用**：点击桌面图标启动麻将助手
2. **开始游戏**：进入麻将游戏界面
3. **查看分析**：悬浮窗会实时显示：
   - 听牌：当前可以胡的牌
   - 最优打：推荐的出牌
   - 风险牌：可能点炮的牌
   - 对手听牌概率：三家对手的听牌可能性
4. **调整位置**：长按悬浮窗可以拖动到合适位置
5. **关闭应用**：点击悬浮窗右上角的关闭按钮

## 构建方法

### 环境要求
- Python 3.12+
- Android SDK（API 33）
- Android NDK r25b
- OpenJDK 17+
- Kivy 2.3.0+
- OpenCV 4.8.0.74

### 本地构建步骤
1. **安装依赖**：
   ```bash
   pip install buildozer appdirs colorama jinja2 sh build toml packaging setuptools
   ```

2. **配置环境变量**：
   ```bash
   export ANDROID_HOME=~/Android/Sdk
   export ANDROID_NDK_HOME=~/Android/Sdk/ndk/25.2.9519653
   export PATH=$PATH:$ANDROID_HOME/cmdline-tools/latest/bin:$ANDROID_HOME/platform-tools
   ```

3. **执行构建**：
   ```bash
   buildozer android debug
   ```

4. **查找APK**：
   构建完成后，APK文件会生成在 `bin/` 目录下

### GitHub Actions构建
1. **Fork仓库**：将项目Fork到自己的GitHub账号
2. **启用Actions**：在仓库设置中启用Actions
3. **运行构建**：进入Actions页面，运行"Build Android App"工作流
4. **下载APK**：构建完成后在Artifacts中下载

## 技术栈

| 类别 | 技术/库 | 版本 | 用途 |
|------|---------|------|------|
| 前端框架 | Kivy | 2.3.0+ | 跨平台GUI |
| 视觉识别 | OpenCV | 4.8.0.74 | 麻将牌识别 |
| 数学计算 | NumPy | 1.24.0+ | 数据处理 |
| 系统接口 | Plyer | 2.1.0+ | 权限管理 |
| 构建工具 | Buildozer | 1.5.0+ | Android打包 |
| 运行环境 | Python | 3.12+ | 核心逻辑 |

## 常见问题

### 1. 悬浮窗不显示
**解决方案**：
- 检查是否授予了悬浮窗权限
- 在系统设置中开启"显示在其他应用上层"权限
- 尝试重启应用

### 2. 识别不准确
**解决方案**：
- 确保麻将牌清晰可见
- 避免牌面被遮挡
- 调整游戏界面亮度
- 尝试切换到更合适的规则

### 3. 应用崩溃
**解决方案**：
- 检查Android系统版本（要求7.0+）
- 确保设备有足够的存储空间
- 尝试清除应用缓存
- 重新安装应用

### 4. 权限被拒绝
**解决方案**：
- 进入系统设置 → 应用 → 麻将助手 → 权限
- 手动开启所有必要权限
- 重启应用

## 注意事项

### 📝 重要提醒
1. **合法使用**：本应用仅供个人娱乐使用，请勿用于任何形式的赌博活动
2. **公平竞技**：建议在朋友间娱乐时使用，尊重麻将游戏的公平性
3. **设备兼容性**：推荐使用Android 7.0以上系统，内存2GB以上设备
4. **性能消耗**：应用会占用一定的CPU和内存资源，建议在性能较好的设备上使用
5. **电池消耗**：长时间使用可能会增加电池消耗，建议适当休息

### 🔒 隐私保护
- 应用不会收集任何个人信息
- 所有分析均在本地完成，不上传任何数据
- 权限仅用于必要的功能实现

### ⚠️ 免责声明
- 本应用仅作为麻将游戏的辅助工具
- 开发者不对使用本应用产生的任何后果负责
- 请遵守当地法律法规，合理使用本应用

## 技术支持

如果遇到问题，可以尝试以下方法：
1. 检查本使用说明中的常见问题
2. 确保按照安装说明正确操作
3. 尝试重新安装应用
4. 检查设备兼容性

---

**版本信息**：v1.0.0
**更新日期**：2026-02-15
**开发者**：麻将助手团队

祝您使用愉快！ 🎉